#!/bin/dash

ns=$1
id=$2
file=$3
host=$(hostname --fqdn)

target_dir=<%= $cfbackup::root_dir %>/$ns/$id

/bin/mkdir -p $target_dir

/usr/bin/sftp backuphost <<EOT
get $host/$ns/$id/$file $target_dir/$file
EOT

cd $target_dir

case "$file" in
*.tar) tar -xf $file ;;
*.tar.bz2) tar -xjf $file ;;
*.tar.gz) tar -xzf $file ;;
*.tar.xz) tar -xJf $file ;;
*) echo "Unknown format"; exit 1 ;;
esac

rm -f $file
